<!DOCTYPE HTML>
<html class="app">

<head>
    <meta charset="utf-8">
    <title>Views</title>
    <style>
	    #label-edit { display: none; }
	    #status-edit { display: none; }
    </style>
</head>

<body>
	
	<div id="input-row1">New Label <input type="text"></div>
	<div id="input-row2">New Status <input type="text"></div>
	<button id="add">Add</button>
	<ul id="todo-list">
		
	</ul>



	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script type="text/javascript" src="../shared/js/utils.js"></script>
	<script type="text/javascript" src="../shared/js/events.js"></script>
	<script type="text/javascript" src="../shared/js/models.js"></script>
	<script type="text/javascript" src="../shared/js/views.js"></script>
	<script type="text/javascript" src="http://underscorejs.org/underscore.js"></script>
	<script type="text/javascript" src="http://backbonejs.org/backbone.js"></script>
	<script>

		// Some sample of how to use our new Model class from our framework
		var TodoItem = SKFramework.Model.extend({
				initialize: function(){
					console.log('hi');
					console.log(TodoItem.prototype.initialize)
				},
				changeStatus: function(_status){
					if(typeof _status == "number"){
						if(_status < 0){
							_status = 0;
						}else if( _status > 1){
							_status = 1;
						}
						this.set('status', _status);
					}
					return this;
				},
				changeLabel: function(_label){
					this.set('label', String(_label))
				}
			});
		
		// Lets now make some TodoItems
		

		


		
		// Lets create a view
		/*
			Notes:
			- Ideal a view only knows about itself and/or the objects you pass to it
			- If you reference specific variables outside the class then you can't reuse it in other projects or other parts of your current app
			- The onDelete function is referencing a glboal variable that may or may not exist and will give an error if it doesnt exist
		*/
		var MyView = SKFramework.View.extend({
			initialize: function(_el, model){
				this.setElement(_el);
				this.render = this.render.bind(this);
				this.onDelete = this.onDelete.bind(this);
				this.model = model;

				this.addListeners();
			},
			addListeners: function(){
				$(this.el).on('click', '#delete', this.onDelete); 
				this.model.on('change', this.render); 
			},
			onDelete: function(){
				var indexToRemove = myViewObj.getIndexOfView(this);
				myViewObj.deleteViewByIndex(indexToRemove);

				var parentEl = this.el.parentNode;
				parentEl.removeChild(this.el);
			},
			render: function(){
				this.el.innerHTML = '<span id="label">' + this.model.get('label') + '</span> - <span id="status">'  + this.model.get('status') + '</span>' + ' <button id="delete">Delete</button>';
				return this.el;
			}
		})

		var AppView = SKFramework.View.extend({
			initialize: function(_el){
				this.setElement(_el);
				this.createOnClick = this.createOnClick.bind(this);
				this.render = this.render.bind(this);
				
				this.todoList = [];
				this.addListeners();
			},
			addListeners: function(){
				$(this.el).on('click', '#add', this.createOnClick); 
				//$(this.el).on('click', '#delete', this.somethingChanged);
			},
			createOnClick: function(){
				// create a model and set it
				var todoItem1 = new TodoItem();
				todoItem1.set('label', this.el.querySelector('#input-row1 input').value);
				todoItem1.set('status', this.el.querySelector('#input-row2 input').value);
				this.el.querySelector('#input-row1 input').value = '';
				this.el.querySelector('#input-row2 input').value = '';

				// create a view, add to an array of views, render and add to DOM
				var newListElement = document.createElement('li');
				this.newView = new MyView(newListElement, todoItem1);
				this.todoList.push(this.newView);
				this.el.querySelector('#todo-list').appendChild(this.newView.render());
			},
			getIndexOfView: function(_view){
				return this.todoList.indexOf(_view);	
			},
			deleteViewByIndex: function(_index){
				this.todoList.splice(_index, 1);
				console.log(this.todoList);
			},
			render: function(){
				this.el.querySelector('#todo-list').innerHTML = '';
				for(var i=0; i<this.todoList.length; i++){
					this.el.querySelector('#todo-list').appendChild(this.todoList[i].render());	
				}
			}
		})

		// create a new model
		// set the model

		// on change of model, the todo view should update itself

		// render should update its DOM element (this.el)

		// add an event listener to the delete button
		// on click, 
		// remove 'this view' from todoList array


		//create new instance of myview
		var myViewObj = new AppView(document.body);

	</script>
</body>

</html>